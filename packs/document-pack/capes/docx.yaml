# DOCX Cape - Word 文档处理
# 源自 Anthropic Claude Skills: document-skills/docx

id: docx
name: Word 文档处理
version: "1.0.0"
description: >
  综合性文档创建、编辑和分析能力，支持修订追踪、评论、格式保留和文本提取。
  适用于创建新文档、修改编辑内容、处理修订追踪、添加评论等文档任务。

metadata:
  author: Anthropic
  license: Proprietary
  source: skill
  source_ref: anthropics/skills/document-skills/docx
  tags:
    - word
    - document
    - docx
    - editing
    - track-changes
    - redline
  intents:
    - 创建Word文档
    - 编辑文档
    - 添加修订
    - 提取文本
    - 文档对比
    - 添加评论
  examples:
    - "创建一份新的Word文档"
    - "编辑这份合同并显示修订"
    - "提取文档中的文本内容"
    - "给文档添加批注"

interface:
  input_schema:
    type: object
    properties:
      task:
        type: string
        description: 文档处理任务描述
      file_path:
        type: string
        description: 输入文件路径
      output_path:
        type: string
        description: 输出文件路径
      track_changes:
        type: boolean
        description: 是否启用修订追踪
        default: false
    required:
      - task
  output_schema:
    type: object
    properties:
      result:
        type: string
        description: 处理结果
      output_file:
        type: string
        description: 输出文件路径
      extracted_text:
        type: string
        description: 提取的文本内容

execution:
  type: hybrid
  entrypoint: scripts/document.py
  timeout_seconds: 120
  tools_allowed:
    - file_read
    - file_write
    - code_execute
    - bash

model_adapters:
  claude:
    model_hint: claude-3-5-sonnet
    system_prompt: |
      你是 Word 文档处理专家。

      ## 工作流程决策树

      ### 读取/分析内容
      使用 pandoc 转换为 markdown：
      ```bash
      pandoc --track-changes=all path-to-file.docx -o output.md
      ```

      ### 创建新文档
      使用 docx-js（JavaScript 库）workflow

      ### 编辑现有文档
      - **自己的文档 + 简单修改**: 基础 OOXML 编辑
      - **他人的文档**: 使用 **Redlining workflow**（推荐）
      - **法律/学术/商业/政府文档**: 必须使用 **Redlining workflow**

      ## Redlining 工作流程

      **批次策略**: 将相关更改分组为 3-10 个更改的批次

      **原则：最小化、精确的编辑**
      只标记实际更改的文本。将替换分解为：
      [未更改文本] + [删除] + [插入] + [未更改文本]

      ### 修订追踪工作流程
      1. 获取 markdown 表示
      2. 识别并分组更改
      3. 读取 ooxml.md 文档并解包
      4. 分批实现更改
      5. 打包文档
      6. 最终验证

      ## 文档转图片
      ```bash
      soffice --headless --convert-to pdf document.docx
      pdftoppm -jpeg -r 150 document.pdf page
      ```

      ## 代码风格
      - 写简洁代码
      - 避免冗余操作

  openai:
    model_hint: gpt-4o
    system_prompt: |
      You are a Word document processing expert.

      Key workflows:
      1. Reading: Use pandoc to convert to markdown
      2. Creating: Use docx-js library
      3. Editing: Use OOXML manipulation with Document library
      4. Track changes: Use Redlining workflow

      For tracked changes, use minimal edits - only mark text that actually changes.

  generic:
    prompt_template: |
      请帮我处理 Word 文档任务：
      {task}

      输入文件：{file_path}
      输出到：{output_path}
      启用修订追踪：{track_changes}

      请根据任务选择合适的工作流程（pandoc转换/docx-js创建/OOXML编辑）。

code_adapter:
  scripts:
    - scripts/__init__.py
    - scripts/document.py
    - scripts/utilities.py
  dependencies:
    - python-docx
    - defusedxml
  runtime: python

safety:
  risk_level: medium
  audit_log: true
  allowed_operations:
    - read
    - write
    - execute
